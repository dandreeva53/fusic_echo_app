// PROTOTYPE rules â€” tighten before production
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Each user can read/write their own doc
    match /users/{userEmail} {
      allow read, write: if request.auth != null && request.auth.token.email == userEmail;

      // Subcollection: scans
      match /scans/{scanId} {
        // Owner can do anything
        allow read, write: if request.auth != null && request.auth.token.email == userEmail;

        // Supervisors can append signatures (example: any authenticated user allowed for prototype)
        allow update: if request.auth != null
                      && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['signatures']);
      }
    }
  }
}
