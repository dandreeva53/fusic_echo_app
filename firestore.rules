// SAFE default for prototype: directory is readable to any signed-in user.
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userEmail} {
      // Directory needs this:
      allow read: if request.auth != null;

      // Only the owner can write their own profile
      allow create, update, delete: if request.auth != null
                                    && request.auth.token.email == userEmail;

      // Trainee scans: owner-only access (we can relax for signatures later)
      match /scans/{scanId} {
        allow read, create, update, delete: if request.auth != null
                                            && request.auth.token.email == userEmail;
      }
    }
  }
}
